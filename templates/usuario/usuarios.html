{% extends "soporte.html" %}
{% block title %} Listado de Usuarios - YURAKU {% endblock %}
{% block content %}
{% load staticfiles %}
<title>Listado de Usuarios - YURAKU </title>
<html class="no-js" lang="en">
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
            <header class="main-header">
                <!-- Logo -->
                <a href="{% url 'homepage' %}" class="logo">
                    <!-- mini logo for sidebar mini 50x50 pixels -->
                    <span class="logo-mini"><b>Y</b>K</span>
                    <!-- logo for regular state and mobile devices -->
                    <span class="logo-lg"><b>YURA</b>KU</span>
                </a>
                <!-- Header Navbar: style can be found in header.less -->
                <nav class="navbar navbar-static-top">
                    <!-- Sidebar toggle button-->
                    <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                        <span class="sr-only">Toggle navigation</span>
                    </a>
                    <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                <!-- User Account: style can be found in dropdown.less -->
                     {% if user.is_authenticated %}
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                {% if perfiles %}
                                    {% for p in perfiles.all %}
                                        {% if p.Usuario_id.id == user.id %}
                                            <img src="{{ p.imagen_perfil.url }}" class="user-image" alt="User Image">
                                        {% else %}
                                            <img src="{% static '/AdminLTE-2.4.2/img/product/usuario.jpg' %}" class="user-image" alt="User Image">
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <img src="{% static '/AdminLTE-2.4.2/img/product/usuario.jpg' %}" class="user-image" alt="User Image">
                                {% endif %}
                                <span class="hidden-xs">{{ user.first_name }} {{ user.last_name }}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">
                                    {% if perfiles %}
                                        {% for p in perfiles.all %}
                                            {% if p.Usuario_id.id == user.id %}
                                                <img src="{{ p.imagen_perfil.url }}" alt="" />
                                            {% else %}
                                                <img src="{% static '/AdminLTE-2.4.2/img/product/usuario.jpg' %}" alt="" />
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <img src="{% static '/AdminLTE-2.4.2/img/product/usuario.jpg' %}" alt="" />
                                    {% endif %}
                                    <p>
                                        {{ user.first_name }} {{ user.last_name }}
                                        <small>{{ user.date_joined }}</small>
                                    </p>
                                </li>
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-left">
                                        {% if perfiles %}
                                            {% for p in perfiles.all %}
                                                {% if p.Usuario_id.id == user.id %}
                                                    <a href="{% url 'perfil_detallado' user.id %}" class="btn btn-default btn-flat">Perfil</a>
                                                {% else %}
                                                    <a href="{% url 'perfil' user.id %}" class="btn btn-default btn-flat">Perfil</a>
                                                {% endif %}
                                            {% endfor %}
                                        {% else %}
                                            <a href="{% url 'perfil' user.id %}" class="btn btn-default btn-flat">Perfil</a>
                                        {% endif %}
                                    </div>
                                    <div class="pull-right">
                                        <a href="{% url 'logout' %}" class="btn btn-default btn-flat">Salir</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="{% static '/AdminLTE-2.4.2/img/product/sinusuario.jpg' %}" class="user-image" alt="User Image">
                                <span class="hidden-xs">Sin Usuario</span>
                            </a>
                            <ul class="dropdown-menu">
                                  <!-- User image -->
                                  <li class="user-header">
                                      <img src="{% static '/AdminLTE-2.4.2/img/product/sinusuario.jpg' %}" alt="" />
                                      <p>
                                          Sin Usuario
                                      </p>
                                  </li>
                                  <!-- Menu Footer-->
                                  <li class="user-footer">
                                      <div class="pull-left">
                                          <a href="{% url 'registro' %}" class="btn btn-default btn-flat">Inciar Sesión</a>
                                      </div>
                                      <div class="pull-right">
                                          <a href="{% url 'registro' %}" class="btn btn-default btn-flat">Registrarse</a>
                                      </div>
                                  </li>
                              </ul>
                        </li>
                    {% endif %}
                    <!-- Control Sidebar Toggle Button -->
                    <li>
                        <a href="#" data-toggle=""><i class="fa fa-gears"></i></a>
                    </li>
                </ul>
                    </div>
                </nav>
            </header>
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar">
                <!-- sidebar: style can be found in sidebar.less -->
                <section class="sidebar">
                    <!-- Sidebar user panel -->
                    <div class="user-panel">
                        {% if user.is_authenticated %}
                            <div class="pull-left image">
                                {% if perfiles %}
                                    {% for p in perfiles.all %}
                                        {% if p.Usuario_id.id == user.id %}
                                            <img src="{{ p.imagen_perfil.url }}" class="img-circle" alt="User Image">
                                        {% else %}
                                            <img src="{% static '/AdminLTE-2.4.2/img/product/usuario.jpg' %}" class="img-circle" alt="User Image">
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <img src="{% static '/AdminLTE-2.4.2/img/product/usuario.jpg' %}" class="img-circle" alt="User Image">
                                {% endif %}
                            </div>
                            <div class="pull-left info">
                                <p>{{ user.first_name }} {{ user.last_name }}</p>
                                <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
                            </div>
                        {% else %}
                            <div class="pull-left image">
                                <img src="{% static '/AdminLTE-2.4.2/img/product/sinusuario.jpg' %}" class="img-circle" alt="User Image">
                            </div>
                            <div class="pull-left info">
                                <p>Sin Usuario</p>
                                <a href="#"><i class="fa fa-circle text-warning"></i> Offline</a>
                            </div>
                        {% endif %}
                    </div>
                    <!-- search form -->
                    <form action="{% url 'buscar_planta' %}" method="get" class="sidebar-form">
                        <div class="input-group">
                            <input type="text" name="q" class="form-control" placeholder="Buscar">
                            <span class="input-group-btn">
                                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i></button>
                            </span>
                        </div>
                    </form>
                    <!-- /.search form -->
                    <!-- sidebar menu: : style can be found in sidebar.less -->
                    <ul class="sidebar-menu" data-widget="tree">
                        <li class="header">Menú de Navegación</li>
                        <li>
                            <a href="{% url 'homepage' %}">
                                <i class="fa fa-home"></i> <span>Inicio</span>
                            </a>
                        </li>
                        {% if user.groups.all|length > 0 %}
                            {% for u in user.groups.all%}
                                {% if u.name == "SuperUsuarios" or u.name == "Administradores" %}
                                    <li class="treeview">
                                        <a href="#">
                                            <i class="fa fa-pagelines"></i>
                                            <span>Plantas Medicinales</span>
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left pull-right"></i>
                                            </span>
                                        </a>
                                        <ul class="treeview-menu">
                                            <li><a href="{% url 'buscar_planta' %}"><i class="fa fa-circle-o"></i> Busqueda de Plantas</a></li>
                                            <li><a href="{% url 'Planta' %}"><i class="fa fa-circle-o"></i>Mis Plantas</a></li>
                                            <li><a href="{% url 'guardar_planta' %}"><i class="fa fa-circle-o"></i> Registro Planta</a></li>
                                        </ul>
                                    </li>
                                {% else %}
                                    <li class="treeview">
                                        <a href="#">
                                            <i class="fa fa-pagelines"></i>
                                            <span>Plantas Medicinales</span>
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left pull-right"></i>
                                            </span>
                                        </a>
                                        <ul class="treeview-menu">
                                            <li><a href="{% url 'buscar_planta' %}"><i class="fa fa-circle-o"></i> Busqueda de Plantas</a></li>
                                            <li><a href="{% url 'Planta' %}"><i class="fa fa-circle-o"></i>Mis Plantas</a></li>
                                        </ul>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <li class="treeview">
                                <a href="#">
                                    <i class="fa fa-pagelines"></i>
                                    <span>Plantas Medicinales</span>
                                    <span class="pull-right-container">
                                        <i class="fa fa-angle-left pull-right"></i>
                                    </span>
                                </a>
                                <ul class="treeview-menu">
                                    <li><a href="{% url 'buscar_planta' %}"><i class="fa fa-circle-o"></i> Busqueda de Plantas</a></li>
                                    <li><a href="{% url 'Planta' %}"><i class="fa fa-circle-o"></i>Mis Plantas</a></li>
                                </ul>
                            </li>
                        {% endif %}
                        <li>
                            <a href="{% url 'Reconocimiento' %}">
                                <i class="fa fa-eye"></i>
                                <span>Reconocimiento de Plantas</span>
                                <span class="pull-right-container">
                                    <i class="fa fa-angle-left pull-right"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'Juego' %}">
                                <i class="fa fa-puzzle-piece"></i>
                                <span>Juegos</span>
                                <span class="pull-right-container">
                                    <i class="fa fa-angle-left pull-right"></i>
                                </span>
                            </a>
                        </li>
                        <li class="treeview active">
                            <a href="#">
                                <i class="fa fa-users"></i> <span>Usuarios</span>
                                <span class="pull-right-container">
                                    <i class="fa fa-angle-left pull-right"></i>
                                </span>
                            </a>
                            <ul class="treeview-menu">
                                <li class="active"><a href="{% url 'usuarios' %}"><i class="fa fa-circle-o"></i> Listado de Usuarios</a></li>
                                <li><a href="{% url 'agregar_usuario' %}"><i class="fa fa-circle-o"></i> Crear Usuarios</a></li>
                            </ul>
                        </li>
                        {% if user.groups.all|length > 0 %}
                            {% for u in user.groups.all%}
                                {% if u.name == "SuperUsuarios" %}
                                    <li class="treeview">
                                        <a href="#">
                                            <i class="fa fa-file-pdf-o"></i>
                                            <span>Reportes</span>
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left pull-right"></i>
                                            </span>
                                        </a>
                                        <ul class="treeview-menu">
                                            <li><a href="{% url 'report_usuario' %}"><i class="fa fa-circle-o"></i> Usuarios</a></li>
                                        </ul>
                                    </li>
                                {% elif u.name == "Administradores" %}
                                    <li class="treeview">
                                        <a href="#">
                                            <i class="fa fa-file-pdf-o"></i>
                                            <span>Reportes</span>
                                            <span class="pull-right-container">
                                                <i class="fa fa-angle-left pull-right"></i>
                                            </span>
                                        </a>
                                        <ul class="treeview-menu">
                                            <li><a href="{% url 'report_usuario' %}"><i class="fa fa-circle-o"></i> Usuarios</a></li>
                                        </ul>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                        {% endif %}
                        {% if user.is_authenticated %}
                            {% if perfiles %}
                                {% for p in perfiles.all %}
                                    {% if p.Usuario_id.id == user.id %}
                                        <li>
                                            <a href="{% url 'perfil_detallado' user.id %}">
                                                <i class="fa fa-user-plus"></i> <span>Perfil</span>
                                                <span class="pull-right-container">
                                                    <i class="fa fa-angle-left pull-right"></i>
                                                </span>
                                            </a>
                                        </li>
                                    {% else %}
                                        <li>
                                            <a href="{% url 'perfil' user.id %}">
                                                <i class="fa fa-user-plus"></i> <span>Perfil</span>
                                                <span class="pull-right-container">
                                                    <i class="fa fa-angle-left pull-right"></i>
                                                </span>
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <li>
                                    <a href="{% url 'perfil' user.id %}">
                                        <i class="fa fa-user-plus"></i> <span>Perfil</span>
                                        <span class="pull-right-container">
                                            <i class="fa fa-angle-left pull-right"></i>
                                        </span>
                                    </a>
                                </li>
                            {% endif %}
                        {% else %}
                            <li>
                                <a href="{% url 'login'%}">
                                    <i class="fa fa-user-plus"></i> <span>Perfil</span>
                                    <span class="pull-right-container">
                                        <i class="fa fa-angle-left pull-right"></i>
                                    </span>
                                </a>
                            </li>
                        {% endif %}
                      </ul>
                </section>
                <!-- /.sidebar -->
            </aside>
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        Usuarios del Sistema
                        <small>YURAKU </small>
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="{% url 'homepage' %}"><i class="fa fa-home"></i>Inicio</a></li>
                        <li class="active">Listado de Usuarios</li>
                    </ol>
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="box">
                                <div class="box-header">
                                    <h3 class="box-title">Lista de Usuarios </h3>
                                </div>
                                <!-- /.box-header -->
                                <div class="box-body">
                                    <table id="example1" class="table table-bordered table-striped">
                                        <thead>
                                        <tr>
                                            <th data-field="id">ID</th>
                                            <th data-field="nombre" >Nombre</th>
                                            <th data-field="apellido">Apellido</th>
                                            <th data-field="email">Email</th>
                                            <th data-field="usuario" >Usuario</th>
                                            <th data-field="fecha de registro y/o sesión" >Fecha de Registro y/o Sesión</th>
                                            <th data-field="fecha de la ultima conexión" >Fecha de la última conexión</th>
                                            <th data-field="tipo_usuario">Tipo de Usuarios</th>
                                            <th data-field="editar tipo de usuario">Editar</th>
                                            <th data-field="eliminar usuario">Eliminar</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for usuario in usuarios %}
                                            <tr>
                                                <td>{{ usuario.id }}</td>
                                                <td>{{ usuario.first_name }}</td>
                                                <td>{{ usuario.last_name }}</td>
                                                <td>{{ usuario.email }}</td>
                                                <td>{{ usuario.username }}</td>
                                                <td>{{ usuario.date_joined }}</td>
                                                <td>{{ usuario.last_login }}</td>
                                                <td>{% for u in usuario.groups.all%}
                                                        {% if u.name %}
                                                            {{ u.name }}
                                                        {% else %}
                                                            No tiene un tipo de Usuario asigando.
                                                        {% endif %}
                                                    {% endfor %}
                                                </td>
                                                <td>
                                                    <a data-toggle="tooltip" title="Editar" class="pd-setting-ed" href="{% url "editar_rol" usuario.id %}">
                                                        <i class="fa fa-edit" aria-hidden="true"></i>
                                                    </a>
                                                </td>
                                                <td>
                                                    <a data-toggle="tooltip" title="Eliminar" class="pd-setting-ed" data-target="#DangerModalhdbgcl" onclick="return confirm('¿Seguro que deseas eliminarlo?')" href="{% url "eliminar_usuario" usuario.id %}">
                                                        <i class="fa fa-trash-o" aria-hidden="true"></i>
                                                    </a>
                                                </td>
                                                </tr>
                                        {% endfor %}
                                        </tbody>
                                        <tfoot>
                                        <tr>

                                            <th data-field="id">ID</th>
                                            <th data-field="nombre" >Nombre</th>
                                            <th data-field="apellido">Apellido</th>
                                            <th data-field="email">Email</th>
                                            <th data-field="usuario" >Usuario</th>
                                            <th data-field="fecha de registro y/o sesión" >Fecha de Registro y/o Sesión</th>
                                            <th data-field="fecha de la ultima conexión" >Fecha de la última conexión</th>
                                            <th data-field="tipo_usuario">Tipo de Usuarios</th>
                                            <th data-field="editar tipo de usuario">Editar</th>
                                            <th data-field="eliminar usuario">Eliminar</th>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <!-- /.box-body -->
                            </div>
                            <!-- /.box -->
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div class="pull-right hidden-xs">
                    <b>Versión</b> 1.0.0
                </div>
                <strong>Copyright &copy; 2019 <a href="https://www.ups.edu.ec/">UPS Cuenca-Ecuador</a>.</strong> Todos los derechos reservados.
            </footer>
        </div>
    </body>
    <script>
        $(function () {
            $('#example1').DataTable();
            $('#example2').DataTable({
                'paging'      : true,
                'lengthChange': false,
                'searching'   : false,
                'ordering'    : true,
                'info'        : true,
                'autoWidth'   : false
            })
        })
    </script>
{% endblock %}